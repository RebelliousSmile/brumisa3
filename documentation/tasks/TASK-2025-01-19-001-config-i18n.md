# Task - Configuration i18n pour Nuxt 4

## Métadonnées

- **ID**: TASK-2025-01-19-001
- **Date de création**: 2025-01-19
- **Créé par**: Claude
- **Priorité**: Haute
- **Statut**: À faire
- **Temps estimé**: 2h
- **Temps réel**: -

## Description

### Objectif

Configurer le module @nuxtjs/i18n pour Nuxt 4 afin de supporter le multilinguisme (FR/EN) pour l'intégration de "Legends in the Mist".

### Contexte

Le projet characters-of-the-mist dispose de traductions complètes FR/EN (35 000+ caractères). Pour intégrer ces traductions dans Brumisater, nous devons d'abord mettre en place l'infrastructure i18n compatible avec Nuxt 4.

### Périmètre

**Inclus dans cette tâche**:
- Installation du module @nuxtjs/i18n
- Configuration de Nuxt pour supporter FR et EN
- Création de la structure de dossiers pour les locales
- Middleware de détection de langue
- Configuration de base (locale par défaut, fallback)

**Exclu de cette tâche** (à traiter séparément):
- Traductions concrètes (TASK-002)
- Composables spécifiques LITM (TASK-003)
- Interface de changement de langue côté utilisateur

## Spécifications Techniques

### Stack & Technologies

- **Framework**: Nuxt 4
- **Langage**: TypeScript
- **Module**: @nuxtjs/i18n v9+
- **Autres outils**: Vue I18n v10

### Architecture

```
app/
├── i18n.config.ts          # Configuration i18n centralisée
├── middleware/
│   └── i18n.ts             # Middleware de détection langue
└── locales/
    ├── fr/
    │   └── common.json     # Traductions FR communes
    └── en/
        └── common.json     # Traductions EN communes
```

### Fichiers Concernés

**Nouveaux fichiers**:
- [ ] `app/i18n.config.ts` - Configuration i18n
- [ ] `app/middleware/i18n.ts` - Middleware détection langue
- [ ] `app/locales/fr/common.json` - Traductions FR de base
- [ ] `app/locales/en/common.json` - Traductions EN de base

**Fichiers à modifier**:
- [ ] `nuxt.config.ts` - Ajout du module i18n
- [ ] `package.json` - Ajout de la dépendance

## Plan d'Implémentation

### Étape 1: Installation du module

**Objectif**: Installer @nuxtjs/i18n et ses dépendances

**Actions**:
- [ ] Exécuter `pnpm add @nuxtjs/i18n@next`
- [ ] Vérifier la compatibilité avec Nuxt 4
- [ ] Mettre à jour package.json

**Fichiers**: `package.json`

**Critères de validation**:
- Le package est installé dans node_modules
- Aucun conflit de dépendances

### Étape 2: Configuration dans nuxt.config.ts

**Objectif**: Activer et configurer le module i18n

**Actions**:
- [ ] Ajouter '@nuxtjs/i18n' dans les modules
- [ ] Configurer les locales (fr, en)
- [ ] Définir la locale par défaut (fr)
- [ ] Configurer le fallback locale (en)
- [ ] Activer le lazy loading des traductions

**Fichiers**: `nuxt.config.ts`

**Critères de validation**:
- L'application démarre sans erreur
- Le module i18n est chargé
- Les routes sont préfixées par la locale

### Étape 3: Création de la structure de dossiers

**Objectif**: Créer l'arborescence pour les fichiers de traduction

**Actions**:
- [ ] Créer le dossier `app/locales/`
- [ ] Créer les sous-dossiers `fr/` et `en/`
- [ ] Créer les fichiers `common.json` vides
- [ ] Ajouter quelques traductions de test

**Fichiers**:
- `app/locales/fr/common.json`
- `app/locales/en/common.json`

**Critères de validation**:
- La structure est conforme
- Les fichiers JSON sont valides

### Étape 4: Configuration i18n centralisée

**Objectif**: Créer le fichier de configuration i18n

**Actions**:
- [ ] Créer `app/i18n.config.ts`
- [ ] Définir les messages pour FR et EN
- [ ] Configurer les options (datetimeFormats, numberFormats si nécessaire)
- [ ] Exporter la configuration

**Fichiers**: `app/i18n.config.ts`

**Critères de validation**:
- La configuration est typée correctement
- Les traductions de test sont accessibles

### Étape 5: Middleware de détection de langue

**Objectif**: Créer un middleware pour détecter la langue préférée

**Actions**:
- [ ] Créer `app/middleware/i18n.ts`
- [ ] Détecter la langue du navigateur
- [ ] Vérifier le cookie/localStorage pour la préférence
- [ ] Rediriger vers la bonne locale si nécessaire

**Fichiers**: `app/middleware/i18n.ts`

**Critères de validation**:
- Le middleware détecte correctement la langue
- Les préférences utilisateur sont respectées
- Pas de boucle de redirection

### Étape 6: Tests de base

**Objectif**: Vérifier que le système i18n fonctionne

**Actions**:
- [ ] Créer une page de test avec `$t()` et `useI18n()`
- [ ] Tester le changement de langue dynamique
- [ ] Vérifier le lazy loading
- [ ] Tester le fallback locale

**Fichiers**: `app/pages/test-i18n.vue` (temporaire)

**Critères de validation**:
- Les traductions s'affichent correctement
- Le changement de langue fonctionne
- Pas d'erreur console

## Tests

### Tests Unitaires

- [ ] Test de la configuration i18n
- [ ] Test du middleware de détection

### Tests d'Intégration

- [ ] Test du chargement des traductions
- [ ] Test du changement de langue
- [ ] Test du fallback

### Tests Manuels

- [ ] Vérifier l'affichage en FR
- [ ] Vérifier l'affichage en EN
- [ ] Tester le changement de langue dans le navigateur

## Dépendances

### Bloqueurs

Aucun bloqueur pour cette tâche.

### Dépendances Externes

- [ ] @nuxtjs/i18n@next (compatible Nuxt 4)

### Tâches Liées

- **TASK-002**: Dépend de cette tâche (extraction traductions)
- **TASK-003**: Dépend de cette tâche (composable i18n)

## Critères d'Acceptation

- [ ] Le code respecte les principes SOLID et DRY
- [ ] Les tests passent avec succès
- [ ] La documentation est à jour
- [ ] Le code suit les conventions du projet (CLAUDE.md)
- [ ] Les variables d'environnement sont utilisées (pas de valeurs en dur)
- [ ] La performance est optimale (lazy loading activé)
- [ ] Le module i18n est correctement configuré
- [ ] Au moins 2 locales (FR, EN) sont supportées
- [ ] Le fallback fonctionne correctement

## Risques & Contraintes

### Risques Identifiés

| Risque | Impact | Probabilité | Mitigation |
|--------|--------|-------------|------------|
| Incompatibilité Nuxt 4 + i18n | Élevé | Faible | Vérifier la documentation officielle, utiliser la version @next |
| Performance (lazy loading) | Moyen | Faible | Activer le lazy loading dès le départ |
| Routes préfixées cassent les liens existants | Moyen | Moyen | Adapter les liens existants, utiliser localePath() |

### Contraintes

- **Technique**: Doit être compatible Nuxt 4
- **Temporelle**: Maximum 2h
- **Ressources**: Documentation @nuxtjs/i18n peut être incomplète pour Nuxt 4
- **Compatibilité**: Doit fonctionner avec SSR et CSR

## Documentation

### Documentation à Créer

- [ ] Commentaires dans `i18n.config.ts`
- [ ] Commentaires dans le middleware

### Documentation à Mettre à Jour

- [ ] Ajouter une section i18n dans CLAUDE.md si nécessaire
- [ ] Mettre à jour le README avec les instructions de traduction

## Revue & Validation

### Checklist avant Review

- [ ] Le code compile sans erreurs
- [ ] Les tests passent
- [ ] Le code est formaté correctement
- [ ] Les fichiers non nécessaires sont exclus
- [ ] Les secrets/tokens sont dans `.env`, pas dans le code

### Reviewers

- [ ] Product Owner (validation fonctionnelle)
- [ ] Developpeur senior (validation technique)

### Critères de Validation

- [ ] Code review approuvée
- [ ] Tests validés
- [ ] Documentation vérifiée
- [ ] Performance acceptable

## Notes de Développement

### Décisions Techniques

**2025-01-19**: Choix d'utiliser @nuxtjs/i18n plutôt qu'une solution custom
- **Raison**: Solution officielle, bien maintenue, compatible Nuxt 4
- **Alternative**: vue-i18n seul (trop bas niveau)

**2025-01-19**: Lazy loading des traductions activé
- **Raison**: Les fichiers de traduction LITM sont volumineux (35 000+ caractères)
- **Impact**: Meilleure performance au chargement initial

### Problèmes Rencontrés

(À remplir pendant l'implémentation)

### Questions & Réponses

**Q**: Faut-il préfixer toutes les routes avec la locale ?
**R**: Oui, pour une meilleure compatibilité SEO et UX

**Q**: Quelle locale par défaut ?
**R**: FR (français), car le projet est principalement francophone

## Résultat Final

(À remplir une fois la tâche terminée)

### Ce qui a été accompli

- [À remplir]

### Déviations par rapport au plan initial

[À remplir]

### Prochaines Étapes Suggérées

- Passer à TASK-002 (Extraction traductions LITM)
- Créer l'interface de changement de langue utilisateur

## Références

- [Documentation @nuxtjs/i18n](https://i18n.nuxtjs.org/)
- [Vue I18n Documentation](https://vue-i18n.intlify.dev/)
- [Nuxt 4 Release Notes](https://nuxt.com/blog/v4)
- [characters-of-the-mist - Source des traductions](https://github.com/Altervayne/characters-of-the-mist)
