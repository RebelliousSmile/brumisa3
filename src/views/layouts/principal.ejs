<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%- typeof title !== 'undefined' ? title : 'GÃ©nÃ©rateur PDF JDR' %></title>
  
  <!-- Meta tags -->
  <meta name="description" content="GÃ©nÃ©rateur de PDFs pour fiches de personnages JDR">
  <meta name="author" content="RebelliousSmile">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/images/favicon.svg">
  
  <!-- Styles -->
  <link href="/css/style.css" rel="stylesheet">
  <%- defineContent('styles') %>
  
  <!-- Google Fonts pour les thÃ¨mes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Roboto+Condensed:ital,wght@0,300;0,400;0,700;1,400&family=Spectral:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
</head>

<body class="min-h-screen bg-gray-50">
  <!-- Messages flash -->
  <% if (typeof messages !== 'undefined' && Object.keys(messages).length > 0) { %>
    <div id="flash-messages" class="fixed top-4 right-4 z-50 space-y-2">
      <% Object.entries(messages).forEach(([type, message]) => { %>
        <div class="alert alert-<%= type %> max-w-sm">
          <div class="flex items-center justify-between">
            <span><%= message %></span>
            <button type="button" class="ml-2 text-gray-400 hover:text-gray-600" onclick="this.parentElement.parentElement.remove()">
              Ã—
            </button>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>

  <!-- Navigation (si utilisateur connectÃ©) -->
  <% if (user) { %>
    <nav class="bg-white shadow-sm border-b">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center h-16">
          <!-- Logo -->
          <div class="flex items-center">
            <a href="/" class="text-xl font-bold text-gray-900">
              ðŸŽ² PDF JDR
            </a>
          </div>

          <!-- Menu principal -->
          <div class="hidden md:flex items-center space-x-6">
            <a href="/personnages" class="text-gray-700 hover:text-gray-900">Mes personnages</a>
            <a href="/pdf" class="text-gray-700 hover:text-gray-900">Mes PDFs</a>
            <% if (user.role === 'ADMIN') { %>
              <a href="/admin" class="text-gray-700 hover:text-gray-900">Administration</a>
            <% } %>
          </div>

          <!-- Menu utilisateur -->
          <div class="flex items-center space-x-4">
            <span class="text-sm text-gray-600">
              Bonjour, <%= user.nom %>
              <% if (user.role !== 'UTILISATEUR') { %>
                <span class="ml-1 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded">
                  <%= user.role %>
                </span>
              <% } %>
            </span>
            <a href="/auth/logout" class="btn btn-secondary text-sm">
              DÃ©connexion
            </a>
          </div>

          <!-- Menu mobile -->
          <div class="md:hidden">
            <button type="button" class="text-gray-500 hover:text-gray-700" onclick="toggleMobileMenu()">
              â˜°
            </button>
          </div>
        </div>

        <!-- Menu mobile -->
        <div id="mobile-menu" class="hidden md:hidden py-4 border-t">
          <a href="/personnages" class="block py-2 text-gray-700 hover:text-gray-900">Mes personnages</a>
          <a href="/pdf" class="block py-2 text-gray-700 hover:text-gray-900">Mes PDFs</a>
          <% if (user.role === 'ADMIN') { %>
            <a href="/admin" class="block py-2 text-gray-700 hover:text-gray-900">Administration</a>
          <% } %>
        </div>
      </div>
    </nav>
  <% } %>

  <!-- Contenu principal -->
  <main>
    <%- body %>
  </main>

  <!-- Scripts -->
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <%- defineContent('scripts') %>

  <script>
    // Utilitaires globaux
    function toggleMobileMenu() {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
    }

    // Auto-hide flash messages
    document.addEventListener('DOMContentLoaded', function() {
      const flashMessages = document.getElementById('flash-messages');
      if (flashMessages) {
        setTimeout(() => {
          flashMessages.querySelectorAll('.alert').forEach(alert => {
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 300);
          });
        }, 5000);
      }
    });

    // Configuration Alpine.js globale
    document.addEventListener('alpine:init', () => {
      Alpine.store('app', {
        user: <%- JSON.stringify(user || null) %>,
        config: <%- JSON.stringify(config) %>,
        messages: [],
        
        // MÃ©thodes utilitaires
        showMessage(type, message) {
          this.messages.push({ type, message, id: Date.now() });
          setTimeout(() => {
            this.messages = this.messages.filter(m => m.id !== this.messages[0].id);
          }, 5000);
        },
        
        isLoggedIn() {
          return this.user !== null;
        },
        
        hasRole(role) {
          return this.user && this.user.role === role;
        }
      });
    });
  </script>
</body>
</html>