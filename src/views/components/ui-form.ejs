<%
/*
 * Composant Formulaire Structuré
 * Usage: <%- include('components/ui-form', { 
 *   formId: 'monFormulaire',
 *   title: 'Titre du formulaire',
 *   action: '/submit',
 *   method: 'POST',
 *   fields: [
 *     {
 *       type: 'text',
 *       name: 'username',
 *       label: 'Nom d\'utilisateur',
 *       required: true,
 *       placeholder: 'Entrez votre nom',
 *       icon: 'fa-solid fa-user'
 *     },
 *     {
 *       type: 'select',
 *       name: 'category',
 *       label: 'Catégorie',
 *       options: [
 *         { value: '1', text: 'Option 1' },
 *         { value: '2', text: 'Option 2' }
 *       ]
 *     }
 *   ],
 *   submitButton: {
 *     text: 'Envoyer',
 *     variant: 'primary',
 *     loading: false
 *   },
 *   cancelButton: {
 *     text: 'Annuler',
 *     href: '/cancel'
 *   },
 *   customClass: ''
 * }) %>
 */

// Paramètres avec valeurs par défaut
const {
    formId = `form-${Math.random().toString(36).substr(2, 9)}`,
    title = '',
    action = '',
    method = 'POST',
    fields = [],
    submitButton = { text: 'Envoyer', variant: 'primary' },
    cancelButton = null,
    customClass = '',
    enctype = ''
} = locals;

// Classes pour le formulaire
const formClasses = [
    'bg-gray-800 rounded-lg border border-gray-700 p-6',
    customClass
].filter(Boolean).join(' ');
%>

<!-- Formulaire Structuré -->
<div class="<%= formClasses %>">
    <!-- Titre du formulaire -->
    <% if (title) { %>
        <div class="mb-6">
            <h2 class="text-2xl font-bold text-white mb-2"><%= title %></h2>
            <div class="h-1 w-16 bg-generique rounded"></div>
        </div>
    <% } %>
    
    <!-- Formulaire -->
    <form 
        id="<%= formId %>"
        action="<%= action %>"
        method="<%= method %>"
        <% if (enctype) { %>enctype="<%= enctype %>"<% } %>
        class="space-y-6"
    >
        <!-- Champs du formulaire -->
        <% fields.forEach((field, index) => { %>
            <div class="form-field">
                <% if (field.type === 'select') { %>
                    <!-- Champ Select -->
                    <div class="space-y-2">
                        <% if (field.label) { %>
                            <label for="<%= field.name %>" class="block text-sm font-medium text-gray-300">
                                <%= field.label %>
                                <% if (field.required) { %>
                                    <span class="text-erreur">*</span>
                                <% } %>
                            </label>
                        <% } %>
                        
                        <div class="relative">
                            <% if (field.icon) { %>
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="<%= field.icon %> text-gray-400"></i>
                                </div>
                            <% } %>
                            
                            <select 
                                id="<%= field.name %>"
                                name="<%= field.name %>"
                                class="block w-full transition-colors duration-200 focus:outline-none px-4 py-3 bg-gray-700 border-2 border-gray-600 rounded-lg text-white focus:border-generique focus:bg-gray-600 <%= field.icon ? 'pl-10' : '' %>"
                                <% if (field.required) { %>required<% } %>
                                <% if (field.disabled) { %>disabled<% } %>
                            >
                                <% if (field.placeholder) { %>
                                    <option value="" disabled <%= !field.value ? 'selected' : '' %>><%= field.placeholder %></option>
                                <% } %>
                                <% (field.options || []).forEach(option => { %>
                                    <option value="<%= option.value %>" <%= field.value === option.value ? 'selected' : '' %>>
                                        <%= option.text %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                        
                        <% if (field.helpText) { %>
                            <p class="text-sm text-gray-400 mt-1"><%= field.helpText %></p>
                        <% } %>
                    </div>
                    
                <% } else if (field.type === 'checkbox') { %>
                    <!-- Champ Checkbox -->
                    <div class="flex items-start space-x-3">
                        <input 
                            type="checkbox"
                            id="<%= field.name %>"
                            name="<%= field.name %>"
                            value="<%= field.value || '1' %>"
                            class="mt-1 h-4 w-4 text-generique focus:ring-generique border-gray-600 rounded bg-gray-700"
                            <% if (field.checked) { %>checked<% } %>
                            <% if (field.required) { %>required<% } %>
                            <% if (field.disabled) { %>disabled<% } %>
                        />
                        <div class="flex-1">
                            <% if (field.label) { %>
                                <label for="<%= field.name %>" class="text-sm font-medium text-gray-300 cursor-pointer">
                                    <%= field.label %>
                                    <% if (field.required) { %>
                                        <span class="text-erreur">*</span>
                                    <% } %>
                                </label>
                            <% } %>
                            <% if (field.helpText) { %>
                                <p class="text-sm text-gray-400 mt-1"><%= field.helpText %></p>
                            <% } %>
                        </div>
                    </div>
                    
                <% } else if (field.type === 'file') { %>
                    <!-- Champ File -->
                    <div class="space-y-2">
                        <% if (field.label) { %>
                            <label for="<%= field.name %>" class="block text-sm font-medium text-gray-300">
                                <%= field.label %>
                                <% if (field.required) { %>
                                    <span class="text-erreur">*</span>
                                <% } %>
                            </label>
                        <% } %>
                        
                        <div class="relative">
                            <input 
                                type="file"
                                id="<%= field.name %>"
                                name="<%= field.name %>"
                                class="block w-full transition-colors duration-200 focus:outline-none px-4 py-3 bg-gray-700 border-2 border-gray-600 rounded-lg text-white focus:border-generique focus:bg-gray-600 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-generique file:text-white hover:file:bg-generique-dark"
                                <% if (field.accept) { %>accept="<%= field.accept %>"<% } %>
                                <% if (field.multiple) { %>multiple<% } %>
                                <% if (field.required) { %>required<% } %>
                                <% if (field.disabled) { %>disabled<% } %>
                            />
                        </div>
                        
                        <% if (field.helpText) { %>
                            <p class="text-sm text-gray-400 mt-1"><%= field.helpText %></p>
                        <% } %>
                    </div>
                    
                <% } else { %>
                    <!-- Champs Input standards (text, email, password, etc.) -->
                    <%- include('ui-input', {
                        type: field.type,
                        name: field.name,
                        label: field.label,
                        placeholder: field.placeholder,
                        value: field.value,
                        required: field.required,
                        disabled: field.disabled,
                        error: field.error,
                        helpText: field.helpText,
                        icon: field.icon,
                        rows: field.rows,
                        maxlength: field.maxlength,
                        pattern: field.pattern,
                        autocomplete: field.autocomplete
                    }) %>
                <% } %>
                
                <!-- Affichage des erreurs -->
                <% if (field.error) { %>
                    <p class="text-sm text-erreur flex items-center mt-1">
                        <i class="fa-solid fa-exclamation-triangle mr-1"></i>
                        <%= field.error %>
                    </p>
                <% } %>
            </div>
        <% }); %>
        
        <!-- Boutons d'action -->
        <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-700">
            <% if (cancelButton) { %>
                <%- include('ui-button', {
                    text: cancelButton.text || 'Annuler',
                    href: cancelButton.href,
                    variant: cancelButton.variant || 'secondary',
                    size: cancelButton.size || 'lg',
                    additionalClasses: 'flex-1 sm:flex-none'
                }) %>
            <% } %>
            
            <%- include('ui-button', {
                text: submitButton.text || 'Envoyer',
                type: 'submit',
                variant: submitButton.variant || 'primary',
                size: submitButton.size || 'lg',
                loading: submitButton.loading || false,
                disabled: submitButton.disabled || false,
                icon: submitButton.icon,
                additionalClasses: 'flex-1 sm:flex-none'
            }) %>
        </div>
    </form>
</div>

<script>
// Validation basique côté client
document.getElementById('<%= formId %>').addEventListener('submit', function(e) {
    const requiredFields = this.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            isValid = false;
            field.classList.add('border-erreur');
            field.focus();
        } else {
            field.classList.remove('border-erreur');
        }
    });
    
    if (!isValid) {
        e.preventDefault();
        // Optionnel: afficher un message d'erreur général
    }
});

// Suppression de l'état d'erreur lors de la saisie
document.querySelectorAll('#<%= formId %> input, #<%= formId %> textarea, #<%= formId %> select').forEach(field => {
    field.addEventListener('input', function() {
        this.classList.remove('border-erreur');
    });
});
</script>