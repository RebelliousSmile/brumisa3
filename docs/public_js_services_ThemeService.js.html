<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/js/services/ThemeService.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/js/services/ThemeService.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Service de gestion des thèmes côté client
 * Architecture MVC-CS - Couche Services (Frontend)
 * 
 * Gère l'application dynamique des thèmes selon le système JDR
 * et la persistence des préférences utilisateur
 */
class ThemeService {
    constructor() {
        this.currentTheme = null;
        this.storageKey = 'brumisater-theme';
        this.systemThemes = {
            monsterhearts: {
                name: 'Monsterhearts',
                description: 'Gothique romantique',
                colors: {
                    primary: '#8b5cf6',
                    secondary: '#ec4899',
                    accent: '#f59e0b'
                }
            },
            engrenages: {
                name: 'Engrenages',
                description: 'Steampunk victorien',
                colors: {
                    primary: '#10b981',
                    secondary: '#a16207',
                    accent: '#fbbf24'
                }
            },
            metro2033: {
                name: 'Metro 2033',
                description: 'Post-apocalyptique',
                colors: {
                    primary: '#dc2626',
                    secondary: '#6b7280',
                    accent: '#fbbf24'
                }
            },
            mistengine: {
                name: 'Mist Engine',
                description: 'Mystique poétique',
                colors: {
                    primary: '#ec4899',
                    secondary: '#a78bfa',
                    accent: '#fbbf24'
                }
            },
            zombiology: {
                name: 'Zombiology',
                description: 'Survival horror',
                colors: {
                    primary: '#eab308',
                    secondary: '#dc2626',
                    accent: '#10b981'
                }
            }
        };
        
        this.init();
    }
    
    /**
     * Initialise le service et applique le thème sauvegardé
     */
    init() {
        // Récupérer le thème sauvegardé ou détecter depuis la page
        const savedTheme = this.getSavedTheme();
        const pageTheme = this.detectPageTheme();
        
        if (savedTheme &amp;&amp; this.systemThemes[savedTheme]) {
            this.applyTheme(savedTheme);
        } else if (pageTheme) {
            this.applyTheme(pageTheme);
        }
        
        // Écouter les changements de thème
        this.listenForThemeChanges();
        
        // Gérer le mode sombre système
        this.handleSystemDarkMode();
    }
    
    /**
     * Applique un thème spécifique
     * @param {string} themeName - Nom du système JDR
     * @param {boolean} save - Sauvegarder en localStorage
     */
    applyTheme(themeName, save = true) {
        if (!this.systemThemes[themeName] &amp;&amp; themeName !== 'default') {
            console.warn(`Thème inconnu: ${themeName}`);
            return false;
        }
        
        // Retirer l'ancien thème
        if (this.currentTheme) {
            document.documentElement.removeAttribute('data-theme');
            document.body.classList.remove(`theme-${this.currentTheme}`);
        }
        
        // Appliquer le nouveau thème
        if (themeName !== 'default') {
            document.documentElement.setAttribute('data-theme', themeName);
            document.body.classList.add(`theme-${themeName}`);
            
            // Mettre à jour les meta tags pour la couleur du navigateur
            this.updateMetaThemeColor(this.systemThemes[themeName].colors.primary);
        }
        
        this.currentTheme = themeName;
        
        // Sauvegarder la préférence
        if (save) {
            this.saveTheme(themeName);
        }
        
        // Déclencher un événement personnalisé
        this.dispatchThemeChangeEvent(themeName);
        
        return true;
    }
    
    /**
     * Détecte le thème depuis les attributs de la page
     * @returns {string|null} Nom du thème détecté
     */
    detectPageTheme() {
        // Vérifier l'attribut data-theme
        const htmlTheme = document.documentElement.getAttribute('data-theme');
        if (htmlTheme) return htmlTheme;
        
        // Vérifier la variable globale gameSystem
        if (window.gameSystem) return window.gameSystem;
        
        // Vérifier les classes du body
        for (const theme in this.systemThemes) {
            if (document.body.classList.contains(`theme-${theme}`)) {
                return theme;
            }
        }
        
        return null;
    }
    
    /**
     * Sauvegarde le thème en localStorage
     * @param {string} themeName - Nom du thème
     */
    saveTheme(themeName) {
        try {
            localStorage.setItem(this.storageKey, themeName);
        } catch (error) {
            console.error('Erreur lors de la sauvegarde du thème:', error);
        }
    }
    
    /**
     * Récupère le thème sauvegardé
     * @returns {string|null} Nom du thème sauvegardé
     */
    getSavedTheme() {
        try {
            return localStorage.getItem(this.storageKey);
        } catch (error) {
            console.error('Erreur lors de la récupération du thème:', error);
            return null;
        }
    }
    
    /**
     * Supprime le thème sauvegardé
     */
    clearSavedTheme() {
        try {
            localStorage.removeItem(this.storageKey);
        } catch (error) {
            console.error('Erreur lors de la suppression du thème:', error);
        }
    }
    
    /**
     * Met à jour la couleur du thème dans les meta tags
     * @param {string} color - Couleur hexadécimale
     */
    updateMetaThemeColor(color) {
        let metaThemeColor = document.querySelector('meta[name="theme-color"]');
        
        if (!metaThemeColor) {
            metaThemeColor = document.createElement('meta');
            metaThemeColor.name = 'theme-color';
            document.head.appendChild(metaThemeColor);
        }
        
        metaThemeColor.content = color;
    }
    
    /**
     * Écoute les changements de thème via événements personnalisés
     */
    listenForThemeChanges() {
        // Écouter les changements depuis Alpine.js
        document.addEventListener('alpine:theme-change', (event) => {
            if (event.detail &amp;&amp; event.detail.theme) {
                this.applyTheme(event.detail.theme);
            }
        });
        
        // Écouter les changements depuis les sélecteurs de thème
        document.addEventListener('change', (event) => {
            if (event.target.matches('[data-theme-selector]')) {
                this.applyTheme(event.target.value);
            }
        });
    }
    
    /**
     * Gère le mode sombre système
     */
    handleSystemDarkMode() {
        // Détecter la préférence système
        const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        
        // Appliquer la classe dark si nécessaire
        this.updateDarkMode(darkModeMediaQuery.matches);
        
        // Écouter les changements
        darkModeMediaQuery.addEventListener('change', (e) => {
            this.updateDarkMode(e.matches);
        });
    }
    
    /**
     * Active ou désactive le mode sombre
     * @param {boolean} isDark - Activer le mode sombre
     */
    updateDarkMode(isDark) {
        if (isDark) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    }
    
    /**
     * Déclenche un événement de changement de thème
     * @param {string} themeName - Nom du nouveau thème
     */
    dispatchThemeChangeEvent(themeName) {
        const event = new CustomEvent('themeChanged', {
            detail: {
                theme: themeName,
                themeData: this.systemThemes[themeName] || null
            }
        });
        
        document.dispatchEvent(event);
    }
    
    /**
     * Récupère les informations du thème actuel
     * @returns {Object|null} Données du thème actuel
     */
    getCurrentThemeData() {
        if (!this.currentTheme || this.currentTheme === 'default') {
            return null;
        }
        
        return this.systemThemes[this.currentTheme];
    }
    
    /**
     * Récupère la liste des thèmes disponibles
     * @returns {Array} Liste des thèmes
     */
    getAvailableThemes() {
        return Object.keys(this.systemThemes).map(key => ({
            id: key,
            ...this.systemThemes[key]
        }));
    }
    
    /**
     * Applique des animations spécifiques au thème
     * @param {string} animationType - Type d'animation
     */
    applyThemeAnimation(animationType) {
        const animations = {
            'pulse': 'animate-pulse-system',
            'glow': 'animate-glow-system',
            'fade': 'animate-fade-system'
        };
        
        if (animations[animationType]) {
            document.documentElement.classList.add(animations[animationType]);
            
            // Retirer l'animation après 3 secondes
            setTimeout(() => {
                document.documentElement.classList.remove(animations[animationType]);
            }, 3000);
        }
    }
    
    /**
     * Précharge les assets spécifiques au thème
     * @param {string} themeName - Nom du thème
     */
    async preloadThemeAssets(themeName) {
        if (!this.systemThemes[themeName]) return;
        
        // Précharger les polices spécifiques
        const fonts = {
            monsterhearts: ['Crimson Text', 'Source Serif 4'],
            engrenages: ['Cinzel'],
            mistengine: ['Dancing Script', 'Kalam']
        };
        
        if (fonts[themeName]) {
            fonts[themeName].forEach(font => {
                const link = document.createElement('link');
                link.rel = 'preload';
                link.as = 'font';
                link.href = `https://fonts.googleapis.com/css2?family=${font.replace(' ', '+')}`;
                document.head.appendChild(link);
            });
        }
    }
}

// Initialiser le service au chargement de la page
if (typeof window !== 'undefined') {
    window.themeService = new ThemeService();
    
    // Intégration avec Alpine.js si disponible
    document.addEventListener('alpine:init', () => {
        Alpine.data('themeManager', () => ({
            currentTheme: window.themeService.currentTheme,
            themes: window.themeService.getAvailableThemes(),
            
            changeTheme(themeName) {
                window.themeService.applyTheme(themeName);
                this.currentTheme = themeName;
            },
            
            resetTheme() {
                window.themeService.applyTheme('default');
                window.themeService.clearSavedTheme();
                this.currentTheme = 'default';
            }
        }));
    });
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Actualite.html">Actualite</a></li><li><a href="AdminController.html">AdminController</a></li><li><a href="AdminOracleService.html">AdminOracleService</a></li><li><a href="AnonymousTokenService.html">AnonymousTokenService</a></li><li><a href="AuthentificationController.html">AuthentificationController</a></li><li><a href="BaseController.html">BaseController</a></li><li><a href="BaseModel.html">BaseModel</a></li><li><a href="BasePdfKitService.html">BasePdfKitService</a></li><li><a href="BaseService.html">BaseService</a></li><li><a href="CacheService.html">CacheService</a></li><li><a href="CharacterSheetDocument.html">CharacterSheetDocument</a></li><li><a href="ClassPlanDocument.html">ClassPlanDocument</a></li><li><a href="DangerDocument.html">DangerDocument</a></li><li><a href="DemandeChangementEmail.html">DemandeChangementEmail</a></li><li><a href="Document.html">Document</a></li><li><a href="DocumentFactory.html">DocumentFactory</a></li><li><a href="DocumentModerationHistorique.html">DocumentModerationHistorique</a></li><li><a href="DocumentModerationService.html">DocumentModerationService</a></li><li><a href="DocumentSystemeJeu.html">DocumentSystemeJeu</a></li><li><a href="DocumentVote.html">DocumentVote</a></li><li><a href="DonationController.html">DonationController</a></li><li><a href="EmailService.html">EmailService</a></li><li><a href="EmailTemplate.html">EmailTemplate</a></li><li><a href="EngrenagesTheme.html">EngrenagesTheme</a></li><li><a href="GenericDocument.html">GenericDocument</a></li><li><a href="GroupDocument.html">GroupDocument</a></li><li><a href="HomeController.html">HomeController</a></li><li><a href="LoggingService.html">LoggingService</a></li><li><a href="MarkdownService.html">MarkdownService</a></li><li><a href="Metro2033Theme.html">Metro2033Theme</a></li><li><a href="MistEngineTheme.html">MistEngineTheme</a></li><li><a href="ModerationController.html">ModerationController</a></li><li><a href="MonsterheartsTheme.html">MonsterheartsTheme</a></li><li><a href="NavigationService.html">NavigationService</a></li><li><a href="Newsletter.html">Newsletter</a></li><li><a href="NewsletterService.html">NewsletterService</a></li><li><a href="Oracle.html">Oracle</a></li><li><a href="OracleController.html">OracleController</a></li><li><a href="OracleItem.html">OracleItem</a></li><li><a href="OracleService.html">OracleService</a></li><li><a href="OrganizationDocument.html">OrganizationDocument</a></li><li><a href="Pdf.html">Pdf</a></li><li><a href="PdfController.html">PdfController</a></li><li><a href="PdfKitService.html">PdfKitService</a></li><li><a href="PdfService.html">PdfService</a></li><li><a href="PerformanceMiddleware.html">PerformanceMiddleware</a></li><li><a href="PerformanceMonitoringService.html">PerformanceMonitoringService</a></li><li><a href="Personnage.html">Personnage</a></li><li><a href="PersonnageController.html">PersonnageController</a></li><li><a href="PersonnageService.html">PersonnageService</a></li><li><a href="ProductionApp.html">ProductionApp</a></li><li><a href="QueueService.html">QueueService</a></li><li><a href="RgpdConsentement.html">RgpdConsentement</a></li><li><a href="RgpdService.html">RgpdService</a></li><li><a href="SecurityService.html">SecurityService</a></li><li><a href="ShareService.html">ShareService</a></li><li><a href="SystemCardViewModel.html">SystemCardViewModel</a></li><li><a href="SystemMaintenanceService.html">SystemMaintenanceService</a></li><li><a href="SystemRightsService.html">SystemRightsService</a></li><li><a href="SystemService.html">SystemService</a></li><li><a href="SystemTheme.html">SystemTheme</a></li><li><a href="SystemThemeService.html">SystemThemeService</a></li><li><a href="SystemeJeu.html">SystemeJeu</a></li><li><a href="Temoignage.html">Temoignage</a></li><li><a href="TemoignageService.html">TemoignageService</a></li><li><a href="TemplateService.html">TemplateService</a></li><li><a href="ThemeService.html">ThemeService</a></li><li><a href="TownDocument.html">TownDocument</a></li><li><a href="Utilisateur.html">Utilisateur</a></li><li><a href="UtilisateurService.html">UtilisateurService</a></li><li><a href="VoteController.html">VoteController</a></li><li><a href="VoteService.html">VoteService</a></li><li><a href="ZombiologyTheme.html">ZombiologyTheme</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AuthComponent">AuthComponent</a></li><li><a href="global.html#InscriptionComponent">InscriptionComponent</a></li><li><a href="global.html#Joi">Joi</a></li><li><a href="global.html#MotDePasseOublieComponent">MotDePasseOublieComponent</a></li><li><a href="global.html#ReinitialiserMotDePasseComponent">ReinitialiserMotDePasseComponent</a></li><li><a href="global.html#actionFlottante">actionFlottante</a></li><li><a href="global.html#ajouterTemoignage">ajouterTemoignage</a></li><li><a href="global.html#asyncHandler">asyncHandler</a></li><li><a href="global.html#auth">auth</a></li><li><a href="global.html#chargerDonneesAccueil">chargerDonneesAccueil</a></li><li><a href="global.html#chargerInfosDons">chargerInfosDons</a></li><li><a href="global.html#choixModeCreation">choixModeCreation</a></li><li><a href="global.html#choixTypeDocument">choixTypeDocument</a></li><li><a href="global.html#compareVersions">compareVersions</a></li><li><a href="global.html#createError">createError</a></li><li><a href="global.html#createMigrationsTable">createMigrationsTable</a></li><li><a href="global.html#createTables">createTables</a></li><li><a href="global.html#creationPersonnage">creationPersonnage</a></li><li><a href="global.html#database">database</a></li><li><a href="global.html#elevationRole">elevationRole</a></li><li><a href="global.html#executeMigration">executeMigration</a></li><li><a href="global.html#fichePersonnage">fichePersonnage</a></li><li><a href="global.html#formaterDate">formaterDate</a></li><li><a href="global.html#formaterNombre">formaterNombre</a></li><li><a href="global.html#formaterTailleFichier">formaterTailleFichier</a></li><li><a href="global.html#genererEtoiles">genererEtoiles</a></li><li><a href="global.html#getCurrentVersion">getCurrentVersion</a></li><li><a href="global.html#getErrorMessage">getErrorMessage</a></li><li><a href="global.html#getExecutedMigrations">getExecutedMigrations</a></li><li><a href="global.html#getMigrationStatus">getMigrationStatus</a></li><li><a href="global.html#getVersionsToMigrate">getVersionsToMigrate</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#handleNotFound">handleNotFound</a></li><li><a href="global.html#initializeDatabase">initializeDatabase</a></li><li><a href="global.html#inscrireNewsletter">inscrireNewsletter</a></li><li><a href="global.html#isDatabaseInitialized">isDatabaseInitialized</a></li><li><a href="global.html#listePersonnages">listePersonnages</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#markMigrationExecuted">markMigrationExecuted</a></li><li><a href="global.html#menuUtilisateur">menuUtilisateur</a></li><li><a href="global.html#mesDocuments">mesDocuments</a></li><li><a href="global.html#migrateDatabase">migrateDatabase</a></li><li><a href="global.html#migrateToLatest">migrateToLatest</a></li><li><a href="global.html#migrateToVersion">migrateToVersion</a></li><li><a href="global.html#migrations">migrations</a></li><li><a href="global.html#navigationFormulaire">navigationFormulaire</a></li><li><a href="global.html#naviguerVersSysteme">naviguerVersSysteme</a></li><li><a href="global.html#optionalAuth">optionalAuth</a></li><li><a href="global.html#ouvrirLienDon">ouvrirLienDon</a></li><li><a href="global.html#partageDocument">partageDocument</a></li><li><a href="global.html#partagerPdf">partagerPdf</a></li><li><a href="global.html#path">path</a></li><li><a href="global.html#previewHtml">previewHtml</a></li><li><a href="global.html#requireAdmin">requireAdmin</a></li><li><a href="global.html#requireAuth">requireAuth</a></li><li><a href="global.html#requirePremium">requirePremium</a></li><li><a href="global.html#resetDatabase">resetDatabase</a></li><li><a href="global.html#rollbackMigration">rollbackMigration</a></li><li><a href="global.html#schemas">schemas</a></li><li><a href="global.html#scrollVersSection">scrollVersSection</a></li><li><a href="global.html#selectionSysteme">selectionSysteme</a></li><li><a href="global.html#updateAppVersion">updateAppVersion</a></li><li><a href="global.html#validateFiles">validateFiles</a></li><li><a href="global.html#validateRequest">validateRequest</a></li><li><a href="global.html#verifierAuth">verifierAuth</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Fri Aug 08 2025 18:20:12 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
