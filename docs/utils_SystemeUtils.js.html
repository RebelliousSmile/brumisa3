<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/SystemeUtils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/SystemeUtils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const { systemesJeu } = require('../config/systemesJeu');

// Fonctions utilitaires pour les systèmes de JDR
const SystemeUtils = {
  /**
   * Récupère un système par son code
   */
  getSysteme(code) {
    return systemesJeu[code] || null;
  },

  /**
   * Liste tous les systèmes disponibles
   */
  getAllSystemes() {
    return Object.values(systemesJeu);
  },

  /**
   * Récupère les noms des systèmes pour sélection
   */
  getSystemesListe() {
    return Object.entries(systemesJeu).map(([code, systeme]) => ({
      code,
      nom: systeme.nom,
      description: systeme.description
    }));
  },

  /**
   * Valide les attributs d'un personnage selon son système
   */
  validerAttributs(codeSysteme, attributs) {
    const systeme = this.getSysteme(codeSysteme);
    if (!systeme) return { valide: false, erreurs: ['Système inconnu'] };

    const erreurs = [];
    
    Object.entries(systeme.attributs).forEach(([code, config]) => {
      const valeur = attributs[code];
      
      if (valeur === undefined || valeur === null) {
        erreurs.push(`Attribut ${config.nom} manquant`);
      } else if (valeur &lt; config.min || valeur > config.max) {
        erreurs.push(`${config.nom} doit être entre ${config.min} et ${config.max}`);
      }
    });

    return {
      valide: erreurs.length === 0,
      erreurs
    };
  },

  /**
   * Calcule le total des attributs pour un système
   */
  getTotalAttributs(codeSysteme, attributs) {
    const systeme = this.getSysteme(codeSysteme);
    if (!systeme) return 0;

    return Object.keys(systeme.attributs).reduce((total, code) => {
      return total + (attributs[code] || 0);
    }, 0);
  },

  /**
   * Récupère la configuration de thème pour un système
   */
  getTheme(codeSysteme) {
    const SystemThemeService = require('../services/SystemThemeService');
    return SystemThemeService.getTheme(codeSysteme);
  },

  /**
   * Vérifie si un skin/archetype est valide pour un système
   */
  validerSkin(codeSysteme, skin) {
    const systeme = this.getSysteme(codeSysteme);
    if (!systeme || !systeme.skins) return true; // Pas de validation si pas de skins définis
    
    // Support des anciens formats (array) et nouveaux formats (object)
    if (Array.isArray(systeme.skins)) {
      return systeme.skins.includes(skin);
    } else {
      return Object.keys(systeme.skins).includes(skin);
    }
  },

  /**
   * Récupère le nom affiché d'une skin
   * @param {string} codeSysteme - Code du système
   * @param {string} skinCode - Code de la skin
   * @returns {string} Nom affiché de la skin
   */
  getSkinDisplayName(codeSysteme, skinCode) {
    const systeme = this.getSysteme(codeSysteme);
    if (!systeme || !systeme.skins) return skinCode;
    
    if (Array.isArray(systeme.skins)) {
      return skinCode;
    } else {
      return systeme.skins[skinCode] || skinCode;
    }
  },

  /**
   * Convertit les données de personnage vers le format template Monsterhearts
   * @param {Object} personnageData - Données brutes du personnage
   * @returns {Object} Données formatées pour le template
   */
  formatForMonsterheartsTemplate(personnageData) {
    const systeme = this.getSysteme('monsterhearts');
    if (!systeme) return personnageData;

    return {
      nom: personnageData.nom || personnageData.name || '',
      donnees_personnage: {
        apparence: personnageData.appearance || personnageData.apparence || '',
        regard: personnageData.eyes || personnageData.regard || '',
        origine: personnageData.origin || personnageData.origine || '',
        skin: personnageData.skin || '',
        stats: {
          hot: personnageData.stats?.hot || 0,
          cold: personnageData.stats?.cold || 0,
          volatile: personnageData.stats?.volatile || 0,
          dark: personnageData.stats?.dark || 0
        },
        moves: {
          basic: this.formatMovesForTemplate(personnageData.moves?.basic, systeme.moves.basic),
          skin: this.formatMovesForTemplate(personnageData.moves?.skin || [], [])
        },
        harm: this.formatTrackForTemplate(personnageData.harm, 4),
        conditions: this.formatConditionsForTemplate(personnageData.conditions, systeme.mechanics.conditions),
        experience: {
          current: personnageData.experience?.current || 0
        },
        strings: this.formatStringsForTemplate(personnageData.strings || []),
        backstory: personnageData.backstory || personnageData.background?.story || '',
        darkestSelf: personnageData.darkestSelf || personnageData.background?.darkestSelf || ''
      },
      notes_privees: personnageData.notes?.player || personnageData.notes_privees || ''
    };
  },

  /**
   * Formate les moves pour le template
   * @param {Array} playerMoves - Moves du joueur
   * @param {Array} availableMoves - Moves disponibles du système
   * @returns {Array} Moves formatées
   */
  formatMovesForTemplate(playerMoves = [], availableMoves = []) {
    return availableMoves.map(move => ({
      checked: playerMoves.some(pm => pm.code === move.code || pm.nom === move.nom),
      description: `&lt;strong>${move.nom}&lt;/strong>: ${move.description}`
    }));
  },

  /**
   * Formate un track (harm, xp) pour le template
   * @param {Array|number} trackData - Données du track
   * @param {number} maxTrack - Maximum du track
   * @returns {Array} Track formaté
   */
  formatTrackForTemplate(trackData, maxTrack) {
    if (Array.isArray(trackData)) {
      return trackData.slice(0, maxTrack);
    }
    
    const track = [];
    for (let i = 0; i &lt; maxTrack; i++) {
      track.push(i &lt; (trackData || 0));
    }
    return track;
  },

  /**
   * Formate les conditions pour le template
   * @param {Array} playerConditions - Conditions du joueur
   * @param {Array} availableConditions - Conditions disponibles
   * @returns {Array} Conditions formatées
   */
  formatConditionsForTemplate(playerConditions = [], availableConditions = []) {
    return availableConditions.map(condition => ({
      name: condition.nom,
      active: playerConditions.some(pc => pc.code === condition.code || pc.nom === condition.nom)
    }));
  },

  /**
   * Formate les strings pour le template
   * @param {Array} strings - Strings du joueur
   * @returns {Array} Strings formatées
   */
  formatStringsForTemplate(strings = []) {
    return strings.map(string => ({
      character: string.character || string.personnage || '',
      value: string.value || string.valeur || 0
    }));
  },

  /**
   * Récupère les mécaniques spécifiques d'un système
   */
  getMecaniques(codeSysteme) {
    const systeme = this.getSysteme(codeSysteme);
    return systeme ? systeme.mechanics : {};
  }
};

module.exports = SystemeUtils;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Actualite.html">Actualite</a></li><li><a href="AdminController.html">AdminController</a></li><li><a href="AdminOracleService.html">AdminOracleService</a></li><li><a href="AnonymousTokenService.html">AnonymousTokenService</a></li><li><a href="AuthentificationController.html">AuthentificationController</a></li><li><a href="BaseController.html">BaseController</a></li><li><a href="BaseModel.html">BaseModel</a></li><li><a href="BasePdfKitService.html">BasePdfKitService</a></li><li><a href="BaseService.html">BaseService</a></li><li><a href="CacheService.html">CacheService</a></li><li><a href="CharacterSheetDocument.html">CharacterSheetDocument</a></li><li><a href="ClassPlanDocument.html">ClassPlanDocument</a></li><li><a href="DangerDocument.html">DangerDocument</a></li><li><a href="DemandeChangementEmail.html">DemandeChangementEmail</a></li><li><a href="Document.html">Document</a></li><li><a href="DocumentFactory.html">DocumentFactory</a></li><li><a href="DocumentModerationHistorique.html">DocumentModerationHistorique</a></li><li><a href="DocumentModerationService.html">DocumentModerationService</a></li><li><a href="DocumentSystemeJeu.html">DocumentSystemeJeu</a></li><li><a href="DocumentVote.html">DocumentVote</a></li><li><a href="DonationController.html">DonationController</a></li><li><a href="EmailService.html">EmailService</a></li><li><a href="EmailTemplate.html">EmailTemplate</a></li><li><a href="EngrenagesTheme.html">EngrenagesTheme</a></li><li><a href="GenericDocument.html">GenericDocument</a></li><li><a href="GroupDocument.html">GroupDocument</a></li><li><a href="HomeController.html">HomeController</a></li><li><a href="LoggingService.html">LoggingService</a></li><li><a href="MaintenanceWorker.html">MaintenanceWorker</a></li><li><a href="MarkdownService.html">MarkdownService</a></li><li><a href="Metro2033Theme.html">Metro2033Theme</a></li><li><a href="MistEngineTheme.html">MistEngineTheme</a></li><li><a href="ModerationController.html">ModerationController</a></li><li><a href="MonsterheartsTheme.html">MonsterheartsTheme</a></li><li><a href="Newsletter.html">Newsletter</a></li><li><a href="NewsletterService.html">NewsletterService</a></li><li><a href="Oracle.html">Oracle</a></li><li><a href="OracleController.html">OracleController</a></li><li><a href="OracleItem.html">OracleItem</a></li><li><a href="OracleService.html">OracleService</a></li><li><a href="OrganizationDocument.html">OrganizationDocument</a></li><li><a href="Pdf.html">Pdf</a></li><li><a href="PdfController.html">PdfController</a></li><li><a href="PdfKitService.html">PdfKitService</a></li><li><a href="PdfService.html">PdfService</a></li><li><a href="PerformanceMiddleware.html">PerformanceMiddleware</a></li><li><a href="PerformanceMonitoringService.html">PerformanceMonitoringService</a></li><li><a href="Personnage.html">Personnage</a></li><li><a href="PersonnageController.html">PersonnageController</a></li><li><a href="PersonnageService.html">PersonnageService</a></li><li><a href="ProductionApp.html">ProductionApp</a></li><li><a href="QueueService.html">QueueService</a></li><li><a href="QueueWorker.html">QueueWorker</a></li><li><a href="RgpdConsentement.html">RgpdConsentement</a></li><li><a href="RgpdService.html">RgpdService</a></li><li><a href="SecurityService.html">SecurityService</a></li><li><a href="ShareService.html">ShareService</a></li><li><a href="SystemCardViewModel.html">SystemCardViewModel</a></li><li><a href="SystemMaintenanceService.html">SystemMaintenanceService</a></li><li><a href="SystemRightsService.html">SystemRightsService</a></li><li><a href="SystemService.html">SystemService</a></li><li><a href="SystemTheme.html">SystemTheme</a></li><li><a href="SystemThemeService.html">SystemThemeService</a></li><li><a href="SystemeJeu.html">SystemeJeu</a></li><li><a href="Temoignage.html">Temoignage</a></li><li><a href="TemoignageService.html">TemoignageService</a></li><li><a href="TemplateService.html">TemplateService</a></li><li><a href="TownDocument.html">TownDocument</a></li><li><a href="Utilisateur.html">Utilisateur</a></li><li><a href="UtilisateurService.html">UtilisateurService</a></li><li><a href="VoteController.html">VoteController</a></li><li><a href="VoteService.html">VoteService</a></li><li><a href="ZombiologyTheme.html">ZombiologyTheme</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Joi">Joi</a></li><li><a href="global.html#asyncHandler">asyncHandler</a></li><li><a href="global.html#auth">auth</a></li><li><a href="global.html#compareVersions">compareVersions</a></li><li><a href="global.html#createError">createError</a></li><li><a href="global.html#createMigrationsTable">createMigrationsTable</a></li><li><a href="global.html#createTables">createTables</a></li><li><a href="global.html#database">database</a></li><li><a href="global.html#executeMigration">executeMigration</a></li><li><a href="global.html#getCurrentVersion">getCurrentVersion</a></li><li><a href="global.html#getErrorMessage">getErrorMessage</a></li><li><a href="global.html#getExecutedMigrations">getExecutedMigrations</a></li><li><a href="global.html#getMigrationStatus">getMigrationStatus</a></li><li><a href="global.html#getVersionsToMigrate">getVersionsToMigrate</a></li><li><a href="global.html#handleError">handleError</a></li><li><a href="global.html#handleNotFound">handleNotFound</a></li><li><a href="global.html#initializeDatabase">initializeDatabase</a></li><li><a href="global.html#isDatabaseInitialized">isDatabaseInitialized</a></li><li><a href="global.html#logger">logger</a></li><li><a href="global.html#markMigrationExecuted">markMigrationExecuted</a></li><li><a href="global.html#migrateDatabase">migrateDatabase</a></li><li><a href="global.html#migrateToLatest">migrateToLatest</a></li><li><a href="global.html#migrateToVersion">migrateToVersion</a></li><li><a href="global.html#migrations">migrations</a></li><li><a href="global.html#optionalAuth">optionalAuth</a></li><li><a href="global.html#path">path</a></li><li><a href="global.html#requireAdmin">requireAdmin</a></li><li><a href="global.html#requireAuth">requireAuth</a></li><li><a href="global.html#requirePremium">requirePremium</a></li><li><a href="global.html#resetDatabase">resetDatabase</a></li><li><a href="global.html#rollbackMigration">rollbackMigration</a></li><li><a href="global.html#schemas">schemas</a></li><li><a href="global.html#updateAppVersion">updateAppVersion</a></li><li><a href="global.html#validateFiles">validateFiles</a></li><li><a href="global.html#validateRequest">validateRequest</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Fri Aug 08 2025 18:17:39 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
